{% extends "base.html" %}

{% block content %}
<div class="search-section">
    <div class="terminal-prompt">
        <span class="prompt-symbol">root@bighole:~#</span>
        <span class="prompt-text">INITIALIZING SEARCH PROTOCOL...</span>
    </div>
    
    {% if error %}
    <div class="error-message">
        <span class="error-icon">[ ! ]</span> ERROR: {{ error }}
    </div>
    {% endif %}
    
    <!-- Progress Bar Container (hidden by default) -->
    <div id="progress-container" class="progress-container" style="display: none;">
        <div class="progress-header">
            <span class="progress-icon">◢◣◤◥</span>
            <span class="progress-label">SEARCHING DATABASE...</span>
        </div>
        <div class="progress-bar-wrapper">
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
                <div class="progress-glitch"></div>
            </div>
        </div>
        <div class="progress-info">
            <span id="progress-text" class="progress-text">Initializing search threads...</span>
            <span id="progress-percent" class="progress-percent">0%</span>
        </div>
        <div class="progress-stats">
            <div class="stat-item">
                <span class="stat-label">THREADS:</span>
                <span class="stat-value">24 ACTIVE</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">STATUS:</span>
                <span id="scan-status" class="stat-value">PROCESSING</span>
            </div>
        </div>
    </div>

    <form method="POST" action="/search" class="search-form" id="search-form">
        <div class="form-group">
            <label class="form-label">
                <span class="label-icon">►</span> SELECT TARGET TYPE:
            </label>
            <select name="search_type" class="form-select" required>
                <option value="" disabled selected>-- SELECT SEARCH TYPE --</option>
                <option value="name">[ NAME ] - Search by Full Name</option>
                <option value="fbid">[ FBID ] - Search by Facebook ID</option>
                <option value="phone">[ PHONE ] - Search by Phone Number</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <span class="label-icon">►</span> ENTER SEARCH QUERY:
            </label>
            <input 
                type="text" 
                name="search_term" 
                class="form-input" 
                placeholder="Type search term..."
                autocomplete="off"
                required
            >
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn-submit" id="submit-btn">
                [ EXECUTE SEARCH ] ▶
            </button>
        </div>
    </form>

    <script>
        document.getElementById('search-form').addEventListener('submit', function(e) {
            // Show progress bar
            document.getElementById('progress-container').style.display = 'block';
            document.getElementById('search-form').style.display = 'none';
            
            // Animate progress bar
            let progress = 0;
            const progressFill = document.getElementById('progress-fill');
            const progressPercent = document.getElementById('progress-percent');
            const progressText = document.getElementById('progress-text');
            const scanStatus = document.getElementById('scan-status');
            
            const messages = [
                'Searching...',
                'Searching...',
                'Searching...',
                'Searching...',
                'Searching...',
                'Searching...',
                'Searching...',
                'Finalizing...'
            ];
            
            let messageIndex = 0;
            
            const interval = setInterval(function() {
                if (progress < 90) {
                    // Slower, more realistic progress for large files
                    if (progress < 20) {
                        progress += Math.random() * 8 + 2;
                    } else if (progress < 50) {
                        progress += Math.random() * 5 + 1;
                    } else if (progress < 80) {
                        progress += Math.random() * 3 + 0.5;
                    } else {
                        progress += Math.random() * 1 + 0.2;
                    }
                    
                    if (progress > 90) progress = 90;
                    
                    progressFill.style.width = progress + '%';
                    progressPercent.textContent = Math.floor(progress) + '%';
                    
                    // Update message based on progress
                    if (progress > messageIndex * 12 && messageIndex < messages.length) {
                        progressText.textContent = messages[messageIndex];
                        messageIndex++;
                    }
                    
                    // Update scan status
                    if (progress < 20) {
                        scanStatus.textContent = 'LOADING';
                    } else if (progress < 85) {
                        scanStatus.textContent = 'SCANNING';
                    } else {
                        scanStatus.textContent = 'FINALIZING';
                    }
                }
            }, 300);  // Slower updates for more realistic feel
            
            // Extended timeout for large datasets
            setTimeout(function() {
                clearInterval(interval);
            }, 120000); // 2 minute safety timeout
        });
    </script>
    
    <div class="info-box">
        <div class="info-line">
            <span class="info-icon">◆</span> Database Status: <span class="text-success">ONLINE</span>
        </div>
        <div class="info-line">
            <span class="info-icon">◆</span> Total Records: <span class="text-highlight">~12GB</span>
        </div>
        <div class="info-line">
            <span class="info-icon">◆</span> Search Engine: <span class="text-highlight">MULTITHREADED</span>
        </div>
        <div class="info-line">
            <span class="info-icon">◆</span> Estimated Time: <span class="text-success">&lt; 10s</span>
        </div>
    </div>
</div>

<div class="terminal-separator">
    ════════════════════════════════════════════════════════════════════════════════
</div>

<div class="usage-guide">
    <div class="guide-title">[ USAGE INSTRUCTIONS ]</div>
    <pre class="guide-content">
    1. Select search type from dropdown menu
    2. Enter exact search term (case-sensitive)
    3. Click EXECUTE SEARCH to begin scanning
    4. Results will appear in &lt; 10 seconds
    
    WARNING: Unauthorized access is prohibited.
    All searches are logged and monitored.
    </pre>
</div>
{% endblock %}
